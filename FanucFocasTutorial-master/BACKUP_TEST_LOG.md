# FANUC CNC 백업 기능 테스트 로그

## 테스트 환경
- 테스트 일시: 2026-01-12
- 대상 설비: 192.168.0.103
- FOCAS API: inventcom.net

---

## 1. NC 프로그램 백업 (BackupAllNCPrograms)

### 기능 설명
- cnc_rdprogdir로 존재하는 프로그램 목록 조회
- 각 프로그램을 cnc_upstart/cnc_upload로 백업
- EW_RESET(-2) 정상 종료 처리
- 프로그레스 바 실시간 업데이트

### 테스트 결과
```
✓ 성공: 233개 프로그램 백업
✓ 실패: 0개
✓ 건너뜀: 9,766개 (존재하지 않는 프로그램)
✓ 파일 위치: G:\Release\net9.0-windows\win-x86\Backup\192.168.0.103-2026-01-12\프로그램\
```

### 백업 파일 예시
- O1.nc, O2.nc, O3.nc ... O9999.nc
- 각 파일에 NC 프로그램 코드 저장

### 개선 사항
- cnc_rdprogdir 실패 시 1~9999 전체 범위로 폴백
- 프로그레스 바로 진행 상황 표시
- 상세한 디버그 로그 (NCBackup_Debug.txt)

---

## 2. 파라미터 백업 (BackupParameter)

### 기능 설명
- 파라미터 0~2000번 백업 (총 2,001개)
- cnc_rdparam API 사용
- 프로그레스 바로 진행 상황 표시

### 예상 결과
```
파일: Parameter.par
형식:
  파라미터번호    축    값
  ────────────────────────────
  0               0     [값]
  1               0     [값]
  ...
  2000            0     [값]
```

### 테스트 방법
1. MainForm에서 "파라미터 백업" 버튼 클릭
2. 프로그레스 바 확인 (0/2000 → 2000/2000)
3. 백업 완료 메시지 확인
4. Backup\[IP]-[날짜]\파라미터\Parameter.par 파일 확인

---

## 3. 공구 옵셋 백업 (BackupToolOffset)

### 기능 설명
- 공구 T001~T200 백업 (총 200개)
- X축/Z축 형상/마모 값 백업
- GetToolOffset 메서드 사용

### 예상 결과
```
파일: ToolOffset.ofs
형식:
  공구번호    X축형상    X축마모    Z축형상    Z축마모
  ──────────────────────────────────────────
  T001        0.000      0.000      0.000      0.000
  T002        0.000      0.000      0.000      0.000
  ...
  T200        0.000      0.000      0.000      0.000
```

### 테스트 방법
1. MainForm에서 "공구 옵셋 백업" 버튼 클릭
2. 백업 완료 메시지 확인
3. Backup\[IP]-[날짜]\공구옵셋\ToolOffset.ofs 파일 확인

---

## 4. 워크 좌표계 백업 (BackupWorkCoordinate)

### 기능 설명
- G54~G59 좌표계 백업 (총 6개)
- cnc_rdzofs API 사용
- X/Y/Z 축 값 백업

### 예상 결과
```
파일: WorkCoordinate.wcs
형식:
  좌표계    X축    Y축    Z축
  ──────────────────────────
  G54       [좌표계 데이터]
  G55       [좌표계 데이터]
  ...
  G59       [좌표계 데이터]
```

### 테스트 방법
1. MainForm에서 "워크 좌표계 백업" 버튼 클릭
2. 백업 완료 메시지 확인
3. Backup\[IP]-[날짜]\좌표계\WorkCoordinate.wcs 파일 확인

---

## 5. 매크로 변수 백업 (BackupMacroVariable)

### 기능 설명
- 매크로 변수 #100~#999 백업 (총 900개)
- cnc_rdmacro API 사용

### 예상 결과
```
파일: MacroVariable.mac
형식:
  변수번호    값
  ──────────────────────
  #100        [값]
  #101        [값]
  ...
  #999        [값]
```

### 테스트 방법
1. MainForm에서 "매크로 변수 백업" 버튼 클릭
2. 백업 완료 메시지 확인
3. Backup\[IP]-[날짜]\매크로\MacroVariable.mac 파일 확인

---

## 6. PMC/래더 백업 (BackupPMCLadder)

### 기능 설명
- PMC R 영역 (R0~R99) 백업
- PMC G 영역 (G0~G99) 백업
- pmc_rdpmcrng API 사용

### 예상 결과
```
파일: PMC_Ladder.pmc
형식:
  [PMC R 영역 (R0-R99)]
  주소 0: [값]
  주소 1: [값]
  ...

  [PMC G 영역 (G0-G99)]
  주소 0: [값]
  주소 1: [값]
  ...
```

### 테스트 방법
1. MainForm에서 "PMC/래더 백업" 버튼 클릭
2. 백업 완료 메시지 확인
3. Backup\[IP]-[날짜]\래더\PMC_Ladder.pmc 파일 확인

---

## 7. 전체 백업 (BackupAll)

### 기능 설명
- 위의 모든 항목을 한 번에 백업
- 각 항목별 성공/실패 기록

### 예상 결과
```
백업 항목:
✓ 공구 옵셋
✓ 워크 좌표계
✓ 매크로 변수
✓ 파라미터
✓ PMC/래더

성공: 5개, 실패: 0개
```

### 테스트 방법
1. MainForm에 "전체 백업" 버튼이 있는지 확인
2. 없다면 추가 구현 필요

---

## 공통 로그 파일

### BackupLog.txt
- 위치: Backup\[IP]-[날짜]\BackupLog.txt
- 내용: 백업 작업 전체 로그
  - 백업 시작/종료 시간
  - 각 항목별 성공/실패
  - 에러 메시지
  - 소요 시간

### NCBackup_Debug.txt (NC 프로그램 백업 전용)
- 위치: 실행 파일 폴더\NCBackup_Debug.txt
- 내용: NC 프로그램 백업 상세 디버그 로그
  - 각 프로그램별 백업 시도
  - API 호출 결과
  - 에러 코드

---

## 다음 단계

1. **각 백업 항목 실제 테스트**
   - 192.168.0.103 설비에 연결
   - 각 백업 버튼 클릭
   - 결과 확인

2. **에러 처리 검증**
   - 연결 끊김 시 동작
   - API 에러 발생 시 처리
   - 파일 쓰기 실패 시 처리

3. **성능 측정**
   - 각 백업 항목별 소요 시간
   - 전체 백업 소요 시간

4. **로그 파일 검증**
   - BackupLog.txt 내용 확인
   - 에러 발생 시 상세 정보 기록 확인

---

## 개선 제안

1. **전체 백업 버튼 추가**
   - 한 번에 모든 항목 백업
   - 프로그레스 바로 전체 진행 상황 표시

2. **백업 스케줄링**
   - 자동 백업 기능
   - 설정한 시간에 자동 백업

3. **백업 이력 관리**
   - 백업 이력 조회
   - 이전 백업과 비교

4. **복원 기능**
   - 백업 파일에서 데이터 복원
   - 복원 전 확인 다이얼로그
